<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>BayesFitness · BayesFitness</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>BayesFitness</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>BayesFitness</a><ul class="internal"><li><a class="tocitem" href="#Example-inference"><span>Example inference</span></a></li><li><a class="tocitem" href="#Contents"><span>Contents</span></a></li><li><a class="tocitem" href="#Index"><span>Index</span></a></li></ul></li><li><a class="tocitem" href="mcmc/">mcmc</a></li><li><a class="tocitem" href="model/">model</a></li><li><a class="tocitem" href="stats/">stats</a></li><li><a class="tocitem" href="utils/">utils</a></li><li><a class="tocitem" href="viz/">viz</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>BayesFitness</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>BayesFitness</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mrazomej/BayesFitness.jl/blob/main/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="BayesFitness"><a class="docs-heading-anchor" href="#BayesFitness">BayesFitness</a><a id="BayesFitness-1"></a><a class="docs-heading-anchor-permalink" href="#BayesFitness" title="Permalink"></a></h1><p>Welcome to the documentation of <code>BayesFitness.jl</code>! The accompanying paper, <em>Bayesian inference of relative fitness on high-throughput pooled competition assays</em>, explains all of the biological and mathematical background needed to understand this package. Here, we only focus on how to use the package, assuming the user already understands the objective of inferring the posterior probability distribution of the relative fitness of mutant strains in a pooled competition assay.</p><p>The package is divided into modules. Here&#39;s a brief description of the content of each module, but please visit their respective documentations to understand what each module is intended for.</p><ul><li><code>utils</code>: Series of miscellaneous functions that make the data wrangling and processing much simpler.</li><li><code>stats</code>: Statistical functions used in the inference problem.</li><li><code>model</code>: <code>Turing.jl</code>-based Bayesian models used to infer the population mean fitness via the neutral lineages as well as the mutants&#39; relative fitness.</li><li><code>mcmc</code>: Package main module with which to perform the Markov-Chain Monte Carlo sampling of the posterior distributions.</li></ul><h2 id="Example-inference"><a class="docs-heading-anchor" href="#Example-inference">Example inference</a><a id="Example-inference-1"></a><a class="docs-heading-anchor-permalink" href="#Example-inference" title="Permalink"></a></h2><p>To get you going with the package, let&#39;s walk through a basic inference pipeline for one competition assay. The first step consists of importing the necessary packages. </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>We use <code>import</code> rather than the more common <code>using</code> command. We find it better to keep the project organized, but feel free to use whatever is more convenient for you!</p></div></div><pre><code class="language-julia hljs"># Import Bayesian inference package
import BayesFitness

# Import libraries to manipulate data
import DataFrames as DF
import CSV</code></pre><p>After having imported the libraries, we need to load our dataset into memory. This dataset is already in the format needed for <code>BayesFitness.jl</code> to work, so we don&#39;t have to modify anything.</p><pre><code class="language-julia hljs"># Import data
data = CSV.read(&quot;~/git/BayesFitness/test/data/data_example_01.csv&quot;, DF.DataFrame)</code></pre><p>Here you will replace <code>&quot;~/git/BayesFitness/test/data&quot;</code> with the directory where your data is stored, and <code>&quot;data_example_01.csv&quot;</code> with the name of the file containing the data. The resulting <code>DataFrame</code> looks something like this:</p><pre><code class="nohighlight hljs">| BCID_x | barcode                                               | name                    | count | time | neutral | count_sum  |   |   |   |
|--------|-------------------------------------------------------|-------------------------|-------|------|---------|------------|---|---|---|
| 0      | TGATCAATCTACAAAAATATTTAATG_GAGTGAAACATGAATGGTATTCATCA | Batch1_1Day-T0_combined | 53    | 0    | FALSE   | 543947     |   |   |   |
| 1      | CCGCCAATCCCGAACCCCGTTTCGCC_ACTCTAACGTGTAACTAATTTTGAGT | Batch1_1Day-T0_combined | 1213  | 0    | FALSE   | 543947     |   |   |   |
| 2      | GACAGAAAAGCCAAATGGATTTACCG_ATGGGAACACGGAATGATCTTTTATT | Batch1_1Day-T0_combined | 17    | 0    | FALSE   | 543947     |   |   |   |
| 3      | CCAACAAAACACAAATCTGTTGTGTA_TACTAAATAAGTAAGGGAATTCTGTT | Batch1_1Day-T0_combined | 19    | 0    | FALSE   | 543947     |   |   |   |
| 4      | TATCGAAACCCAAAGAGATTTAATCG_ATGACAAACTTTAAATAATTTAATTG | Batch1_1Day-T0_combined | 23    | 0    | FALSE   | 543947     |   |   |   |
| 5      | TATCGAAACCCAAAGAGATTTAATCG_CGATCAAAGACTAACTTATTTTGTGG | Batch1_1Day-T0_combined | 16    | 0    | FALSE   | 543947     |   |   |   |
| 6      | TATCGAAACCCAAAGAGATTTAATCG_TTGCCAAGCTGGAAAGCTTTTTATGA | Batch1_1Day-T0_combined | 12    | 0    | FALSE   | 543947     |   |   |   |
| 7      | ATCACAATAACTAAACTGATTCTTCA_CTCATAACATCAAAAAAAATTCAAAT | Batch1_1Day-T0_combined | 161   | 0    | FALSE   | 543947     |   |   |   |
| 8      | TATCGAAACCCAAAGAGATTTAATCG_GTTTAAACCATTAATTATATTAGATC | Batch1_1Day-T0_combined | 19    | 0    | FALSE   | 543947     |   |   |   |</code></pre><p>The relevant columns in this data frame are:</p><ul><li><code>barcode</code>: The unique ID that identifies the barcode.</li><li><code>count</code>: The number of reads for this particular barcode.</li><li><code>time</code>: The time point ID indicating the order in which samples were taken.</li><li><code>neutral</code>: Indicator of whether the barcode belongs to a neutral lineage or not.</li></ul><h3 id="Inferring-the-population-mean-fitness"><a class="docs-heading-anchor" href="#Inferring-the-population-mean-fitness">Inferring the population mean fitness</a><a id="Inferring-the-population-mean-fitness-1"></a><a class="docs-heading-anchor-permalink" href="#Inferring-the-population-mean-fitness" title="Permalink"></a></h3><p>With the data in hand, our first task is to infer the population mean fitness using the neutral lineages. For this, we use the <a href="mcmc/#BayesFitness.mcmc.mcmc_mean_fitness-Tuple{}"><code>BayesFitness.mcmc.mcmc_mean_fitness</code></a> function from the <code>mcmc</code> module. The main parameters we need to define are:</p><ul><li><code>:data</code>: Tidy data frame containing the raw barcode counts.</li><li><code>:n_walkers</code>: Number of MCMC chains to run in parallel. NOTE: Having multiple chains run in parallel is convenient for diagnostics. <code>BayesFitness.jl</code> will use the available threads, so make sure you have more than one thread in your <code>julia</code> session if you want to run this inference in a multi-threaded way.</li><li><code>:outputdir</code>: String pointing to the output directory.</li><li><code>outputname</code>: String defining the pattern for the output files. This can be something related to the dataset. For example, the growth media, or the date of the experiment, of whatever metadata used to distinguish different datasets.</li><li><code>model</code>: Bayesian model from the <code>model</code> module that defines the posterior distribution to be sampled.</li><li><code>model_kwargs</code>: The parameters required by the <code>model</code> function.</li></ul><p>We compile all of these parameters into a dictionary that looks something like this:</p><pre><code class="language-julia hljs">param = Dict(
    :data =&gt; data, 
    :n_walkers =&gt; 3, 
    :n_steps =&gt; 1_000,
    :outputdir =&gt; &quot;./output/&quot;,
    :outputname =&gt; &quot;data_01_meanfitness&quot;,
    :model =&gt; BayesFitness.model.mean_fitness_neutrals_lognormal,
    :model_kwargs =&gt; Dict(
        :α =&gt; BayesFitness.stats.dirichlet_prior_neutral(
            data[data.time.==0, :neutral],
        )
    )
)</code></pre><p>We are now ready to sample the posterior distribution for the population mean fitness. <code>BayesFitness.jl</code> makes this very easy by using the <a href="@ref"><code>Bayes.mcmc.mcmc_mean_fitness</code></a> function from the <code>mcmc</code> module. All we have to do is run</p><pre><code class="language-julia hljs"># Run inference
BayesFitness.mcmc.mcmc_mean_fitness(; param...)</code></pre><p>The output of this function are <a href="https://github.com/JuliaIO/JLD2.jl"><code>jld2</code></a> files that save the native data structure. To extract the MCMC samples of the variable we care about–-equivalent to marginalizing out all the nuisance variables–-we can use the <a href="utils/#BayesFitness.utils.var_jld2_to_df"><code>BayesFitness.utils.var_jld2_to_df</code></a> from the <code>utils</code> module, indicating the name of the variable we want to extract.</p><pre><code class="language-julia hljs">BayesFitness.utils.var_jld2_to_df(&quot;./output/&quot;, &quot;data_01_meanfitness&quot;, :sₜ)</code></pre><h3 id="Inferring-mutants&#39;-relative-fitness"><a class="docs-heading-anchor" href="#Inferring-mutants&#39;-relative-fitness">Inferring mutants&#39; relative fitness</a><a id="Inferring-mutants&#39;-relative-fitness-1"></a><a class="docs-heading-anchor-permalink" href="#Inferring-mutants&#39;-relative-fitness" title="Permalink"></a></h3><p>Once we make sure that the mutants relative fitness looks okay, we can tackle the inference of each mutant relative fitness. The process is very similar, the main difference being that we use the results from the previous step as part of the inputs that go into the corresponding Bayesian model defined in the <code>model</code> module. More specifically, the inferred population mean fitness enters our inference as a &quot;prior&quot; on this value. This prior has to be parametrized, for which we chose a Gaussian distribution. So we need to fit one Gaussian distribution for each MCMC chain sampled in the previous section. The <a href="stats/#BayesFitness.stats.gaussian_prior_mean_fitness-Tuple{DataFrames.AbstractDataFrame}"><code>BayesFitness.stats.gaussian_prior_mean_fitness</code></a> function in the <code>stats</code> module can help us with this.</p><pre><code class="language-julia hljs"># Infer mean fitness distributions
mean_fitness_dist = BayesFitness.stats.gaussian_prior_mean_fitness(
    BayesFitness.utils.var_jld2_to_df(&quot;./output/&quot;, &quot;data_01_meanfitness&quot;, :sₜ)
)</code></pre><p>We can now define the dictionary containing the parameters that go into the [<code>BayesFitness.mcmc.mcmc_mutants_fitness_multithread</code>] function from the <code>mcmc</code> module. </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Notice that we can either use the [<code>BayesFitness.mcmc.mcmc_mutants_fitness_multithread</code>] or the [<code>BayesFitness.mcmc.mcmc_mutants_fitness</code>] function. The difference being that the first one can run multiple mutants simultaneously, but only one chain at the time, while the second one can run the chains in parallel, but only one mutant at the time. You might need to use either depending on what you are trying to do, but we recommend the <code>_multithread</code> function to speed up the inference of thousands of fitness values.</p></div></div><pre><code class="language-julia hljs"># Define function parameters
param = Dict(
    :data =&gt; data,
    :n_walkers =&gt; 3,
    :n_steps =&gt; 1_000,
    :outputdir =&gt; &quot;./output/&quot;,
    :outputname =&gt; &quot;data_01_mutantfitness&quot;,
    :model =&gt; BayesFitness.model.mutant_fitness_lognormal,
    :model_kwargs =&gt; Dict(
        :α =&gt; BayesFitness.stats.beta_prior_mutant(
            data[data.time.==0, :barcode],
        ),
        :μ_s̄ =&gt; mean_fitness_dist[1],
        :σ_s̄ =&gt; mean_fitness_dist[2],
    )
)</code></pre><p>Finally, we run the inference.</p><pre><code class="language-julia hljs"># Run inference
BayesFitness.mcmc.mcmc_mutant_fitness_multithread(; param...)</code></pre><h2 id="Contents"><a class="docs-heading-anchor" href="#Contents">Contents</a><a id="Contents-1"></a><a class="docs-heading-anchor-permalink" href="#Contents" title="Permalink"></a></h2><ul><li><a href="#BayesFitness">BayesFitness</a></li><li class="no-marker"><ul><li><a href="#Example-inference">Example inference</a></li><li><a href="#Contents">Contents</a></li><li><a href="#Index">Index</a></li></ul></li><li><a href="mcmc/#mcmc">mcmc</a></li><li><a href="model/#model">model</a></li><li><a href="stats/#stats">stats</a></li><li><a href="utils/#utils">utils</a></li><li><a href="viz/#viz">viz</a></li></ul><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="mcmc/#BayesFitness.mcmc.mcmc_mean_fitness-Tuple{}"><code>BayesFitness.mcmc.mcmc_mean_fitness</code></a></li><li><a href="mcmc/#BayesFitness.mcmc.mcmc_mutant_fitness-Tuple{}"><code>BayesFitness.mcmc.mcmc_mutant_fitness</code></a></li><li><a href="mcmc/#BayesFitness.mcmc.mcmc_mutant_fitness_multithread-Tuple{}"><code>BayesFitness.mcmc.mcmc_mutant_fitness_multithread</code></a></li><li><a href="model/#BayesFitness.model.mean_fitness_neutrals_lognormal-Tuple{Vector{Int64}, Vector{Int64}}"><code>BayesFitness.model.mean_fitness_neutrals_lognormal</code></a></li><li><a href="model/#BayesFitness.model.mean_fitness_neutrals_lognormal_priors-Tuple{Vector{Int64}, Vector{Int64}}"><code>BayesFitness.model.mean_fitness_neutrals_lognormal_priors</code></a></li><li><a href="model/#BayesFitness.model.mutant_fitness_lognormal-Tuple{Vector{Int64}, Vector{Int64}}"><code>BayesFitness.model.mutant_fitness_lognormal</code></a></li><li><a href="model/#BayesFitness.model.mutant_fitness_lognormal_priors-Tuple{Vector{Int64}, Vector{Int64}}"><code>BayesFitness.model.mutant_fitness_lognormal_priors</code></a></li><li><a href="stats/#BayesFitness.stats.beta_prior_mutant-Tuple{Vector}"><code>BayesFitness.stats.beta_prior_mutant</code></a></li><li><a href="stats/#BayesFitness.stats.dirichlet_prior_neutral-Tuple{Vector{Bool}}"><code>BayesFitness.stats.dirichlet_prior_neutral</code></a></li><li><a href="stats/#BayesFitness.stats.freq_mutant_ppc-Tuple{DataFrames.AbstractDataFrame, Union{AbstractString, Symbol}, Union{AbstractString, Symbol}, Union{AbstractString, Symbol}}"><code>BayesFitness.stats.freq_mutant_ppc</code></a></li><li><a href="stats/#BayesFitness.stats.freq_mutant_ppc-Tuple{MCMCChains.Chains}"><code>BayesFitness.stats.freq_mutant_ppc</code></a></li><li><a href="stats/#BayesFitness.stats.freq_mutant_ppc_quantile-Tuple{Vector{&lt;:AbstractFloat}, DataFrames.AbstractDataFrame, Union{AbstractString, Symbol}, Union{AbstractString, Symbol}, Union{AbstractString, Symbol}}"><code>BayesFitness.stats.freq_mutant_ppc_quantile</code></a></li><li><a href="stats/#BayesFitness.stats.freq_mutant_ppc_quantile-Tuple{Vector{&lt;:AbstractFloat}, MCMCChains.Chains}"><code>BayesFitness.stats.freq_mutant_ppc_quantile</code></a></li><li><a href="stats/#BayesFitness.stats.gaussian_prior_mean_fitness-Tuple{DataFrames.AbstractDataFrame}"><code>BayesFitness.stats.gaussian_prior_mean_fitness</code></a></li><li><a href="stats/#BayesFitness.stats.logfreqratio_neutral_ppc_quantile-Tuple{Vector{&lt;:AbstractFloat}, DataFrames.AbstractDataFrame}"><code>BayesFitness.stats.logfreqratio_neutral_ppc_quantile</code></a></li><li><a href="utils/#BayesFitness.utils.chain_to_df"><code>BayesFitness.utils.chain_to_df</code></a></li><li><a href="utils/#BayesFitness.utils.var_jld2_concat"><code>BayesFitness.utils.var_jld2_concat</code></a></li><li><a href="utils/#BayesFitness.utils.var_jld2_to_df"><code>BayesFitness.utils.var_jld2_to_df</code></a></li><li><a href="viz/#BayesFitness.viz.freq_mutant_ppc!-Tuple{Makie.Axis, Vector{&lt;:AbstractFloat}, MCMCChains.Chains}"><code>BayesFitness.viz.freq_mutant_ppc!</code></a></li><li><a href="viz/#BayesFitness.viz.freq_mutant_ppc!-Tuple{Makie.Axis, Vector{&lt;:AbstractFloat}, DataFrames.AbstractDataFrame, Union{AbstractString, Symbol}, Union{AbstractString, Symbol}, Union{AbstractString, Symbol}}"><code>BayesFitness.viz.freq_mutant_ppc!</code></a></li><li><a href="viz/#BayesFitness.viz.logfreqratio_neutral_ppc!-Tuple{Makie.Axis, Vector{&lt;:AbstractFloat}, DataFrames.AbstractDataFrame}"><code>BayesFitness.viz.logfreqratio_neutral_ppc!</code></a></li><li><a href="viz/#BayesFitness.viz.mcmc_trace_density!-Tuple{Makie.Figure, MCMCChains.Chains}"><code>BayesFitness.viz.mcmc_trace_density!</code></a></li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="mcmc/">mcmc »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 13 April 2023 06:23">Thursday 13 April 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
