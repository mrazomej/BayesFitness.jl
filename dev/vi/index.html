<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>vi (Variational Inference) · BayesFitness</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BayesFitness</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">BayesFitness</a></li><li><a class="tocitem" href="../mcmc/">mcmc</a></li><li><a class="tocitem" href="../model/">model</a></li><li><a class="tocitem" href="../stats/">stats</a></li><li><a class="tocitem" href="../utils/">utils</a></li><li class="is-active"><a class="tocitem" href>vi (Variational Inference)</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>vi (Variational Inference)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>vi (Variational Inference)</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mrazomej/BayesFitness.jl/blob/main/docs/src/vi.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="vi-(Variational-Inference)"><a class="docs-heading-anchor" href="#vi-(Variational-Inference)">vi (Variational Inference)</a><a id="vi-(Variational-Inference)-1"></a><a class="docs-heading-anchor-permalink" href="#vi-(Variational-Inference)" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="BayesFitness.vi.advi-Tuple{}" href="#BayesFitness.vi.advi-Tuple{}"><code>BayesFitness.vi.advi</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">advi(; kwargs)</code></pre><p>Function to sample the joint posterior distribution for the fitness value of all mutant and neutral lineages given a time-series barcode count.</p><p>This function expects the data in a <strong>tidy</strong> format. This means that every row represents <strong>a single observation</strong>. For example, if we measure barcode <code>i</code> in 4 different time points, each of these four measurements gets an individual row. Furthermore, barcode <code>j</code> measurements over time also get their own individual rows. </p><p>The <code>DataFrame</code> must contain at least the following columns:</p><ul><li><code>id_col</code>: Column identifying the ID of the barcode. This can be the barcode   sequence, for example.</li><li><code>time_col</code>: Column defining the measurement time point.  </li><li><code>count_col</code>: Column with the raw barcode count.</li><li><code>neutral_col</code>: Column indicating whether the barcode is from a neutral lineage</li></ul><p>.</p><p><strong>Keyword Arguments</strong></p><ul><li><code>data::DataFrames.AbstractDataFrame</code>: <strong>Tidy dataframe</strong> with the data to be</li></ul><p>used to sample from the population mean fitness posterior distribution.</p><ul><li><code>n_walkers::Int</code>: Number of walkers (chains) for the MCMC sample.</li><li><code>n_steps::Int</code>: Number of steps to take.</li><li><code>outputname::String</code>: String to name the <code>.csv</code> output file.</li><li><code>model::Function</code>: <code>Turing.jl</code> model defining the posterior distribution from   which to sample (see <code>BayesFitness.model</code> module). This function must take   as the first four inputs the following:<ul><li><code>R̲̲::Array{Int64}</code>: 2 or 3D array containing the raw barcode counts for   all tracked genotypes. The dimensions of this array represent:  <ul><li>dim=1: time.</li><li>dim=2: genotype.</li><li>dim=3 (optional): experimental repeats</li></ul></li><li><code>n̲ₜ::VecOrMat{Int64}</code>: Array with the total barcode counts for each time   point (on each experimental repeat, if necessary).</li><li><code>n_neutral::Int</code>: Number of neutral lineages.</li><li><code>n_bc::Int</code>: Number of neutral lineages.</li></ul></li></ul><p><strong>Optional Keyword Arguments</strong></p><ul><li><code>model_kwargs::Dict=Dict()</code>: Extra keyword arguments to be passed to the <code>model</code> function.<ul><li><code>id_col::Symbol=:barcode</code>: Name of the column in <code>data</code> containing the</li></ul>barcode identifier. The column may include any type of entry.</li><li><code>time_col::Symbol=:time</code>: Name of the column in <code>data</code> defining the time point at which measurements were done. The column may contain any type of entry as long as <code>sort</code> will result in time-ordered names.</li><li><code>count_col::Symbol=:count</code>: Name of the column in <code>data</code> containing the raw barcode count. The column must contain entries of type <code>Int64</code>.</li><li><code>neutral_col::Symbol=:neutral</code>: Name of the column in <code>data</code> defining whether the barcode belongs to a neutral lineage. The column must contain entries of type <code>Bool</code>.</li><li><code>rep_col::Union{Nothing,Symbol}=nothing</code>: Column indicating the experimental replicate each measurement belongs to. Default is <code>nothing</code>.</li><li><code>env_col::Union{Nothing,Symbol}=nothing</code>: Column indicating the environment in which each measurement was performed. Default is <code>nothing</code>.</li><li><code>genotype_col::Union{Nothing,Symbol}=nothing</code>: Column indicating the genotype each barcode belongs to when fitting a hierarchical model on genotypes. Default is <code>nothing</code>.</li><li><code>rm_T0::Bool=false</code>: Optional argument to remove the first time point from the inference. The data from this first time point is commonly of much lower quality. Therefore, removing this first time point might result in a better inference.</li><li><code>advi::Turing.AdvancedVI.VariationalInference=Tuing.ADVI(1, 10_000)</code>: Variational inference algorithm to infer. Currently, <code>Turing.jl</code> only supports <code>ADVI</code>, where the first input is the number of samples to take (empirically one sample works), and the second is the number of update steps to take.</li><li><code>opt::Union{Turing.AdvancedVI.DecayedADAGrad,Flux.Optimise.AbstractOptimiser} = Turing.Variational.DecayedADAGrad(1e-2, 1.1, 0.9)</code>: Algorithm used to compute the model gradient and update the parameters. <code>Turing.ADVI</code> can take <code>Flux.jl</code> optimizers. But the recommended algorithm in <code>Stan</code> is the default <code>DecayedADAGrad</code>.  </li><li><code>verbose::Bool=true</code>: Boolean indicating if the function should print partial progress to the screen or not.<h1>Returns</h1><ul><li><code>df::DataFrames.DataFrame</code>: DataFrame containing summary statistics of</li></ul>posterior samples for each parameter. Columns include:     - <code>mean, std</code>: posterior mean and standard deviation for each variable.     - <code>varname</code>: parameter name from the ADVI posterior distribution.     - <code>vartype</code>: Description of the type of parameter. The types are:         - <code>pop_mean_fitness</code>: Population mean fitness value <code>s̲ₜ</code>.         - <code>pop_error</code>: (Nuisance parameter) Log of standard deviation in the           likelihood function for the neutral lineages.         - <code>bc_fitness</code>: Mutant relative fitness <code>s⁽ᵐ⁾</code>.         - <code>bc_hyperfitness</code>: For hierarchical models, mutant hyperparameter           that connects the fitness over multiple experimental replicates or           multiple genotypes <code>θ⁽ᵐ⁾</code>.         - <code>bc_noncenter</code>: (Nuisance parameter) For hierarchical models,           non-centered samples used to connect the experimental replicates to           the hyperparameter <code>θ̃⁽ᵐ⁾</code>.         - <code>bc_deviations</code>: (Nuisance parameter) For hierarchical models,           samples that define the log of the deviation from the hyperparameter           fitness value <code>logτ⁽ᵐ⁾</code>.         - <code>bc_error</code>: (Nuisance parameter) Log of standard deviation in the           likelihood function for the mutant lineages.         - <code>freq</code>: (Nuisance parameter) Log of the Poisson parameter used to           define the frequency of each lineage.     - rep: Experimental replicate number.     - env: Environment for each parameter.     - id: Mutant or neutral strain ID.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/mrazomej/BayesFitness.jl/blob/1fd158362f1a2b83a0e60fa52f85e6a758468612/src/vi.jl#L25-L126">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../utils/">« utils</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 1 September 2023 15:52">Friday 1 September 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
